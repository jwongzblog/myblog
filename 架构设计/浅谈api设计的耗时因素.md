作为后端开发，设计并实现对外响应的api，不难。无非是选择rpc还是http，选好通信框架后再考虑安全、并发、松耦合，这是教科书上的白纸黑字，但是真正有客户端在访问你的api时，才真正开始考验你工具箱是否够硬朗。

我觉得很重要，但是常常被忽略的地方，就是一个**api的响应时长**，因为它决定了客户端的调用行为。一个后端开发者不能太纯粹，需要适当写一点前端或者桌面端的代码，这样一来你的api设计、实现才会降低what's the fu**/second的频率。

**举例一个场景，看我的方案之前自己先思考一下**
*设计并实现一组web api，可以做到从本地导入一个xml格式的文本，从文本中解析出一个企业的组织架构，并写入你的系统中*

你要考虑如下几个场景：
* 如果这个企业是个大集团，他们的组织架构信息有几M，这个文本如何导入
* 文本导入到服务器上后，如何确保多租户模式下，或者多角色并发操作下，不会产生冲突
* 文本导入成功后开始进入流程，解析->整理->写入数据库，这个时间要花费3分钟，此时你的api是接到请求立即返回还是等待处理完毕再响应
* 如果立即返回，上面那个步骤出错了，你的异常信息如何展示
* 出现异常后，所有操作回滚还是说retry的时候继续走完上次的流程
* 我们的web框架是否是分布式无状态的，如何确保每个请求都能拿到正确的进度
* **还是说你的实现就是让web的请求傻等，逼着前端放开25秒超时的限制，30分钟不够就一小时，页面卡死，留着一个菊花在浏览器中间转**

我想此时的你多么希望一个有经验的架构师指导一下，到底该怎么办？妥协还是推倒重来，架构师也不起这个责任，你们老板也不干，你会吐槽架构设计这么烂......最终出于进度，大家妥协了。终于有一天，你也会成为那个被吐槽的架构师，但愿你还没转管理。

对不起，我也没有完美的解决方案，不过我可以介绍一些好的产品如何解决这个问题。这些方案通常不是局部改点代码就能解决问题的，而是一开始的架构设计就考虑了这类问题。
**语言描述太干，我贴个图吧。**
![image.png](https://github.com/jwongzblog/myblog/blob/master/image/api-take-time.png)
这是openstack云数据库组件的一个api设计，因为创建一个数据库实例最少也得两分钟，不可能让caller等待创建完毕再拿到响应结果，所以这个api是立即响应，拿到的状态是数据库实例正在创建中。后续就可以通过get请求，轮询数据库实例的状态。如果你的web想要进度条，那么你也可以在status里，多加一些数字来解决进度的问题。
**进度条绝对比菊花的体验要好**

其实**把一个大的东西、耗时的东西切片处理**大家都懂，只是你还没想到哪些地方能使用。比如往磁盘里写数据，你会切成64M调接口，这是接口设计者逼着调用者这么做的，作为新手的我肯定希望去掉这个切片的动作，因为麻烦，但是麻烦是有道理的。

**留个题目**
*设计一组api，让web前端加载出整个企业的组织架构*

聪明的你肯定想到了分页处理，但是我真的没有成功说服他们，感觉好失败
